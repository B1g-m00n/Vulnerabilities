Source code download：https://github.com/getgrav/grav/releases/tag/1.7.50.1

Grav CMS v1.7.50.1 suffers from a remote code execution vulnerability in the "Direct Install" plugin upload feature, allowing authenticated administrators to execute arbitrary PHP code on the server.

Type: Authenticated Remote Code Execution (RCE)
Location: (Direct Install > Admin Panel > Tools) /admin/tools/direct-install
Impact: Arbitrary PHP code execution and potential full system compromise
Authentication Required: Yes (Administrator access)


Entry function: taskDirectInstall()

**Location**: `user/plugins/admin/classes/plugin/AdminController.php:1244`

```php
protected function taskDirectInstall()
{
    //  Permission Check - need admin.super
    if (!$this->authorizeTask('install', ['admin.super'])) {
        return false;
    }

    $file_path = $this->data['file_path'] ?? null;

    // Processing uploaded files
    if (isset($_FILES['uploaded_file'])) {
        
        //  Check for upload errors
        switch ($_FILES['uploaded_file']['error']) {
            case UPLOAD_ERR_OK: break;
            case UPLOAD_ERR_NO_FILE: /* Returns an error */ return false;
            // ... Other error checking
        }

        $file_name = $_FILES['uploaded_file']['name'];
        $file_path = $_FILES['uploaded_file']['tmp_name'];

        //  Check the file name - but only the file name!
        if (!Utils::checkFilename($file_name)) {
            return false;  // Reject dangerous file names
        }
    }

    // Key issue: calling the installation directly without verifying the ZIP contents!
$result = Gpm::directInstall($file_path);  
Tracking ---> Still not filtered
    
    if ($result === true) {
        $this->admin->setMessage('INSTALLATION_SUCCESSFUL', 'info');
    }
    
    return true;
}

search "direct-install" Keywords

C:\Users\Administrator\Desktop\YM\grav-admin-v1.7.50.1\grav-admin\user\plugins\admin\admin.php

// admin.php Line 377
public function onAdminTools(Event $event)
{
    $event['tools'] = array_merge($event['tools'], [
        'backups'        => [['admin.maintenance'], 'PLUGIN_ADMIN.BACKUPS'],
        'scheduler'      => [['admin.super'], 'PLUGIN_ADMIN.SCHEDULER'],
        'direct-install' => [['admin.super'], 'PLUGIN_ADMIN.DIRECT_INSTALL'],
        //      ↑                    ↑                        ↑
        //   URL slug           Required permissions                  Title Key
    ]);
}

C:\Users\Administrator\Desktop\YM\grav-admin-v1.7.50.1\grav-admin\user\plugins\admin\themes\grav\templates\partials\tools-direct-install.html.twig
路径：<form action="{{ admin_route('/tools/direct-install') }}" method="post" enctype="multipart/form-data">
http://test.com/admin/tools/direct-install





File upload leads to RCE
**Location**: `user/plugins/admin/classes/plugin/AdminController.php:1244`

1. Obtaining admin.super permissions (via phishing/brute force attacks, etc.)
   ↓
2. Creating a malicious plugin package containing a PHP backdoor
   ↓
3.Visit /admin/tools/direct-install to upload
   ↓
4.The system automatically decompresses and installs it to user/plugins/
   ↓
5.Access backdoor: /?cmd=whoami execute arbitrary commands

Use the official error plugin: https://getgrav.org/downloads/plugins

Plugin direct download link:
https://codeload.github.com/getgrav/grav-plugin-error/legacy.zip/refs/tags/1.8.1
getgrav-grav-plugin-error-1.8.1-0-g1c3395a.zip

Triggering the error page will result in an RCE.



